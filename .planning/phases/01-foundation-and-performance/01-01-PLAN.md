---
phase: 01-foundation-and-performance
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - astro.config.mjs
  - tsconfig.json
  - .nvmrc
  - netlify.toml
  - src/env.d.ts
autonomous: true

must_haves:
  truths:
    - "Astro project builds successfully with `npm run build`"
    - "Sharp image service is configured with lanczos3 kernel and AVIF/WebP support"
    - "Netlify deployment config specifies correct build command, publish directory, Node version, security headers, and asset caching"
  artifacts:
    - path: "package.json"
      provides: "Astro 5.17+ project with sitemap integration"
      contains: "astro"
    - path: "astro.config.mjs"
      provides: "Image optimization config with Sharp, sitemap, responsive defaults"
      contains: "lanczos3"
    - path: "tsconfig.json"
      provides: "TypeScript strict mode with Astro path aliases"
      contains: "strictest"
    - path: "netlify.toml"
      provides: "Build config, Node version, security headers, asset cache-control"
      contains: "Cache-Control"
    - path: ".nvmrc"
      provides: "Node version pinning for Netlify and local dev"
      contains: "20"
  key_links:
    - from: "astro.config.mjs"
      to: "package.json"
      via: "imports astro and sitemap packages"
      pattern: "import.*@astrojs/sitemap"
    - from: "netlify.toml"
      to: "astro.config.mjs"
      via: "build command runs astro build, publishes dist/"
      pattern: "astro build"
---

<objective>
Initialize the Astro 5.17+ project with TypeScript, Sharp image optimization, and Netlify deployment configuration. This establishes the performance-optimized foundation that all subsequent phases build on.

Purpose: Create the project skeleton with correct tooling so that layouts, components, and pages can be added immediately in Plan 02.
Output: A buildable (empty) Astro project with production-ready configuration for image optimization, deployment, security headers, and asset caching.
</objective>

<execution_context>
@/Users/andydev/.claude/get-shit-done/workflows/execute-plan.md
@/Users/andydev/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-and-performance/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Initialize Astro project with TypeScript and Sharp</name>
  <files>package.json, astro.config.mjs, tsconfig.json, src/env.d.ts, .nvmrc</files>
  <action>
    Run from the project root (/Users/andydev/dev/philly):

    1. Create .nvmrc with content "20" (pin Node version for Netlify and local dev).

    2. Initialize Astro project using the minimal template with strict TypeScript:
       ```
       npm create astro@latest . -- --template minimal --typescript strict --no-install
       ```
       Use `.` as the project directory (current directory). The `--no-install` flag prevents auto-install so we can add integrations first. If the command asks about overwriting existing files, allow it (only .git and .planning exist).

    3. Add the sitemap integration:
       ```
       npx astro add sitemap --yes
       ```
       This adds @astrojs/sitemap to package.json and updates astro.config.mjs.

    4. Install all dependencies:
       ```
       npm install
       ```

    5. Configure astro.config.mjs with the following settings (replace whatever the template generated):
       - site: 'https://jajatours.co.za'
       - integrations: [sitemap()]
       - image.service with Sharp config: kernel 'lanczos3', background white {r:255, g:255, b:255, alpha:1}
       - image.domains: ['res.cloudinary.com'] (for future Cloudinary use)
       - build.inlineStylesheets: 'auto' (inline small stylesheets to reduce requests)
       - build.assets: '_astro'
       - vite.build.chunkSizeWarningLimit: 600

    6. Ensure tsconfig.json extends "astro/tsconfigs/strictest" and has path aliases:
       ```json
       {
         "extends": "astro/tsconfigs/strictest",
         "compilerOptions": {
           "baseUrl": ".",
           "paths": {
             "@layouts/*": ["src/layouts/*"],
             "@components/*": ["src/components/*"],
             "@assets/*": ["src/assets/*"],
             "@styles/*": ["src/styles/*"]
           }
         }
       }
       ```

    Do NOT install prettier or astro-cloudinary yet. Keep dependencies minimal for Phase 1.
  </action>
  <verify>
    Run `npm run build` from project root. Build must complete without errors and produce a `dist/` directory.
    Run `node --version` and confirm it shows v20.x.
    Verify astro.config.mjs contains 'lanczos3' and 'res.cloudinary.com'.
    Verify .nvmrc contains "20".
  </verify>
  <done>
    Astro project builds successfully. Sharp configured with lanczos3 kernel. TypeScript strict mode enabled with path aliases. Node version pinned to 20.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Netlify deployment configuration</name>
  <files>netlify.toml</files>
  <action>
    Create netlify.toml in the project root with:

    1. [build] section:
       - command = "npm run build"
       - publish = "dist"

    2. [build.environment] section:
       - NODE_VERSION = "20"

    3. Security headers for all routes (/*):
       - X-Frame-Options: DENY
       - X-Content-Type-Options: nosniff
       - Referrer-Policy: strict-origin-when-cross-origin
       - Permissions-Policy: camera=(), microphone=(), geolocation=()

    4. Asset caching headers for /_astro/* (Astro's hashed assets):
       - Cache-Control: public, max-age=31536000, immutable

    5. Image caching headers for /assets/* :
       - Cache-Control: public, max-age=86400

    This ensures the site deploys correctly on Netlify with proper security and caching from day one.
  </action>
  <verify>
    Verify netlify.toml exists and contains:
    - "npm run build" as build command
    - "dist" as publish directory
    - NODE_VERSION = "20"
    - X-Frame-Options header
    - Cache-Control with max-age=31536000 for _astro assets
  </verify>
  <done>
    netlify.toml configured with build settings, Node version, security headers, and asset caching. Ready for Netlify deployment.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` completes without errors
2. `dist/` directory is created
3. astro.config.mjs has Sharp with lanczos3, sitemap integration, Cloudinary domain
4. tsconfig.json has strict mode and path aliases (@layouts, @components, @assets, @styles)
5. netlify.toml has build config, security headers, and cache-control
6. .nvmrc specifies Node 20
</verification>

<success_criteria>
- Astro 5.17+ project builds cleanly with zero errors
- All configuration files present and correctly populated
- Project ready for layout and component development (Plan 02)
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-and-performance/01-01-SUMMARY.md`
</output>
